// @yaireo/tagify@4.32.0 downloaded from https://ga.jspm.io/npm:@yaireo/tagify@4.32.0/dist/tagify.esm.js

var n="&#8203;";function e(n,O){(null==O||O>n.length)&&(O=n.length);for(var _=0,C=new Array(O);_<O;_++)C[_]=n[_];return C}function i(n){return function(n){if(Array.isArray(n))return e(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||function(n,O){if(n){if("string"==typeof n)return e(n,O);var _=Object.prototype.toString.call(n).slice(8,-1);"Object"===_&&n.constructor&&(_=n.constructor.name);return"Map"===_||"Set"===_?Array.from(_):"Arguments"===_||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_)?e(n,O):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var O={isEnabled:function(){var n;return null===(n=window.TAGIFY_DEBUG)||void 0===n||n},log:function(){for(var n=arguments.length,O=new Array(n),_=0;_<n;_++)O[_]=arguments[_];var C;this.isEnabled()&&(C=console).log.apply(C,["[Tagify]:"].concat(i(O)))},warn:function(){for(var n=arguments.length,O=new Array(n),_=0;_<n;_++)O[_]=arguments[_];var C;this.isEnabled()&&(C=console).warn.apply(C,["[Tagify]:"].concat(i(O)))}},s=function(n,O,_,C){return n=""+n,O=""+O,C&&(n=n.trim(),O=O.trim()),_?n==O:n.toLowerCase()==O.toLowerCase()},a=function(n,O){return n&&Array.isArray(n)&&n.map((function(n){return o(n,O)}))};function o(n,O){var _,C={};for(_ in n)O.indexOf(_)<0&&(C[_]=n[_]);return C}function r(n){return(new DOMParser).parseFromString(n.trim(),"text/html").body.firstElementChild}function l(n,O){for(O=O||"previous";n=n[O+"Sibling"];)if(3==n.nodeType)return n}function d(n){return"string"==typeof n?n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/`|'/g,"&#039;"):n}function c(n){var O=Object.prototype.toString.call(n).split(" ")[1].slice(0,-1);return n===Object(n)&&"Array"!=O&&"Function"!=O&&"RegExp"!=O&&"HTMLUnknownElement"!=O}function u(n,O,_){var C,A;function a(n,O){for(var _ in O)if(O.hasOwnProperty(_)){if(c(O[_])){c(n[_])?a(n[_],O[_]):n[_]=Object.assign({},O[_]);continue}if(Array.isArray(O[_])){n[_]=Object.assign([],O[_]);continue}n[_]=O[_]}}return C=n,(null!=(A=Object)&&"undefined"!=typeof Symbol&&A[Symbol.hasInstance]?A[Symbol.hasInstance](C):C instanceof A)||(n={}),a(n,O),_&&a(n,_),n}function g(){var n=[],O={},_=!0,C=!1,A=void 0;try{for(var k,L=arguments[Symbol.iterator]();!(_=(k=L.next()).done);_=!0){var j=k.value,U=!0,Q=!1,Y=void 0;try{for(var Z,tt=j[Symbol.iterator]();!(U=(Z=tt.next()).done);U=!0){var et=Z.value;c(et)?O[et.value]||(n.push(et),O[et.value]=1):n.includes(et)||n.push(et)}}catch(n){Q=!0,Y=n}finally{try{U||null==tt.return||tt.return()}finally{if(Q)throw Y}}}}catch(n){C=!0,A=n}finally{try{_||null==L.return||L.return()}finally{if(C)throw A}}return n}function h(n){return String.prototype.normalize?"string"==typeof n?n.normalize("NFD").replace(/[\u0300-\u036f]/g,""):void 0:n}var p=function(){return/(?=.*chrome)(?=.*android)/i.test(navigator.userAgent)};function f(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(n){return(n^crypto.getRandomValues(new Uint8Array(1))[0]&15>>n/4).toString(16)}))}function m(n){return n&&n.classList&&n.classList.contains(this.settings.classNames.tag)}function v(n){return n&&n.closest(this.settings.classNames.tagSelector)}function b(n,O){var _=window.getSelection();return O=O||_.getRangeAt(0),"string"==typeof n&&(n=document.createTextNode(n)),O&&(O.deleteContents(),O.insertNode(n)),n}function w(n,_,C){return n?(_&&(n.__tagifyTagData=C?_:u({},n.__tagifyTagData||{},_)),n.__tagifyTagData):(O.warn("tag element doesn't exist",{tagElm:n,data:_}),_)}function y(n){if(n&&n.parentNode){var O=n,_=window.getSelection(),C=_.getRangeAt(0);_.rangeCount&&(C.setStartAfter(O),C.collapse(!0),_.removeAllRanges(),_.addRange(C))}}function T(n,O){n.forEach((function(n){if(w(n.previousSibling)||!n.previousSibling){var _=document.createTextNode("​");n.before(_),O&&y(_)}}))}var _={delimiters:",",pattern:null,tagTextProp:"value",maxTags:1/0,callbacks:{},addTagOnBlur:!0,addTagOn:["blur","tab","enter"],onChangeAfterBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,userInput:!0,focusable:!0,keepInvalidTags:!1,createInvalidTags:!0,mixTagsAllowedAfter:/,|\.|\:|\s/,mixTagsInterpolator:["[[","]]"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:function(){},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:" "},autoComplete:{enabled:!0,rightKey:!1,tabKey:!1},classNames:{namespace:"tagify",mixMode:"tagify--mix",selectMode:"tagify--select",input:"tagify__input",focus:"tagify--focus",tagNoAnimation:"tagify--noAnim",tagInvalid:"tagify--invalid",tagNotAllowed:"tagify--notAllowed",scopeLoading:"tagify--loading",hasMaxTags:"tagify--hasMaxTags",hasNoTags:"tagify--noTags",empty:"tagify--empty",inputInvalid:"tagify__input--invalid",dropdown:"tagify__dropdown",dropdownWrapper:"tagify__dropdown__wrapper",dropdownHeader:"tagify__dropdown__header",dropdownFooter:"tagify__dropdown__footer",dropdownItem:"tagify__dropdown__item",dropdownItemActive:"tagify__dropdown__item--active",dropdownItemHidden:"tagify__dropdown__item--hidden",dropdownItemSelected:"tagify__dropdown__item--selected",dropdownInital:"tagify__dropdown--initial",tag:"tagify__tag",tagText:"tagify__tag-text",tagX:"tagify__tag__removeBtn",tagLoading:"tagify__tag--loading",tagEditing:"tagify__tag--editable",tagFlash:"tagify__tag--flash",tagHide:"tagify__tag--hide"},dropdown:{classname:"",enabled:2,maxItems:10,searchKeys:["value","searchBy"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,includeSelectedTags:!1,escapeHTML:!0,highlightFirst:!0,closeOnSelect:!0,clearOnSelect:!0,position:"all",appendTarget:null},hooks:{beforeRemoveTag:function(){return Promise.resolve()},beforePaste:function(){return Promise.resolve()},suggestionClick:function(){return Promise.resolve()},beforeKeyDown:function(){return Promise.resolve()}}};function D(n,O,_){return O in n?Object.defineProperty(n,O,{value:_,enumerable:!0,configurable:!0,writable:!0}):n[O]=_,n}function x(n){for(var O=1;O<arguments.length;O++){var _=null!=arguments[O]?arguments[O]:{},C=Object.keys(_);"function"==typeof Object.getOwnPropertySymbols&&(C=C.concat(Object.getOwnPropertySymbols(_).filter((function(n){return Object.getOwnPropertyDescriptor(_,n).enumerable})))),C.forEach((function(O){D(n,O,_[O])}))}return n}function I(n,O){return O=null!=O?O:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(O)):function(n,O){var _=Object.keys(n);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(n);O&&(C=C.filter((function(O){return Object.getOwnPropertyDescriptor(n,O).enumerable}))),_.push.apply(_,C)}return _}(Object(O)).forEach((function(_){Object.defineProperty(n,_,Object.getOwnPropertyDescriptor(O,_))})),n}function S(n,O){(null==O||O>n.length)&&(O=n.length);for(var _=0,C=new Array(O);_<O;_++)C[_]=n[_];return C}function E(n,O,_){return O in n?Object.defineProperty(n,O,{value:_,enumerable:!0,configurable:!0,writable:!0}):n[O]=_,n}function M(n){return function(n){if(Array.isArray(n))return S(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||function(n,O){if(n){if("string"==typeof n)return S(n,O);var _=Object.prototype.toString.call(n).slice(8,-1);"Object"===_&&n.constructor&&(_=n.constructor.name);return"Map"===_||"Set"===_?Array.from(_):"Arguments"===_||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_)?S(n,O):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(){for(var n in this.dropdown={},this._dropdown)this.dropdown[n]="function"==typeof this._dropdown[n]?this._dropdown[n].bind(this):this._dropdown[n];this.dropdown.refs(),this.DOM.dropdown.__tagify=this}var C,A,k=(C=function(n){for(var O=1;O<arguments.length;O++){var _=null!=arguments[O]?arguments[O]:{},C=Object.keys(_);"function"==typeof Object.getOwnPropertySymbols&&(C=C.concat(Object.getOwnPropertySymbols(_).filter((function(n){return Object.getOwnPropertyDescriptor(_,n).enumerable})))),C.forEach((function(O){E(n,O,_[O])}))}return n}({},{events:{binding:function(){var n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=this.dropdown.events.callbacks,_=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this,null),onKeyDown:O.onKeyDown.bind(this),onMouseOver:O.onMouseOver.bind(this),onMouseLeave:O.onMouseLeave.bind(this),onClick:O.onClick.bind(this),onScroll:O.onScroll.bind(this)},C=n?"addEventListener":"removeEventListener";"manual"!=this.settings.dropdown.position&&(document[C]("scroll",_.position,!0),window[C]("resize",_.position),window[C]("keydown",_.onKeyDown)),this.DOM.dropdown[C]("mouseover",_.onMouseOver),this.DOM.dropdown[C]("mouseleave",_.onMouseLeave),this.DOM.dropdown[C]("mousedown",_.onClick),this.DOM.dropdown.content[C]("scroll",_.onScroll)},callbacks:{onKeyDown:function(n){var _=this;if(this.state.hasFocus&&!this.state.composing){var C=this.settings,A=this.DOM.dropdown.querySelector(C.classNames.dropdownItemActiveSelector),k=this.dropdown.getSuggestionDataByNode(A),L="mix"==C.mode,j="select"==C.mode;C.hooks.beforeKeyDown(n,{tagify:this}).then((function(U){switch(n.key){case"ArrowDown":case"ArrowUp":case"Down":case"Up":n.preventDefault();var Q=_.dropdown.getAllSuggestionsRefs(),Y="ArrowUp"==n.key||"Up"==n.key;A&&(A=_.dropdown.getNextOrPrevOption(A,!Y)),A&&A.matches(C.classNames.dropdownItemSelector)||(A=Q[Y?Q.length-1:0]),_.dropdown.highlightOption(A,!0);break;case"Escape":case"Esc":_.dropdown.hide();break;case"ArrowRight":if(_.state.actions.ArrowLeft||C.autoComplete.rightKey)return;case"Tab":var Z=!C.autoComplete.rightKey||!C.autoComplete.tabKey;if(!L&&!j&&A&&Z&&!_.state.editing&&k){n.preventDefault();var tt=_.dropdown.getMappedValue(k);return _.state.autoCompleteData=k,_.input.autocomplete.set.call(_,tt),!1}return!0;case"Enter":n.preventDefault(),_.state.actions.selectOption=!0,setTimeout((function(){return _.state.actions.selectOption=!1}),100),C.hooks.suggestionClick(n,{tagify:_,tagData:k,suggestionElm:A}).then((function(){if(A)return _.dropdown.selectOption(A),A=_.dropdown.getNextOrPrevOption(A,!Y),void _.dropdown.highlightOption(A);_.dropdown.hide(),L||_.addTags(_.state.inputText.trim(),!0)})).catch((function(n){return O.warn(n)}));break;case"Backspace":if(L||_.state.editing.scope)return;var et=_.input.raw.call(_);""!=et&&8203!=et.charCodeAt(0)||(!0===C.backspace?_.removeTags():"edit"==C.backspace&&setTimeout(_.editTag.bind(_),0))}}))}},onMouseOver:function(n){var O=n.target.closest(this.settings.classNames.dropdownItemSelector);this.dropdown.highlightOption(O)},onMouseLeave:function(n){this.dropdown.highlightOption()},onClick:function(n){var _=this;if(0==n.button&&n.target!=this.DOM.dropdown&&n.target!=this.DOM.dropdown.content){var C=n.target.closest(this.settings.classNames.dropdownItemSelector),A=this.dropdown.getSuggestionDataByNode(C);this.state.actions.selectOption=!0,setTimeout((function(){return _.state.actions.selectOption=!1}),100),this.settings.hooks.suggestionClick(n,{tagify:this,tagData:A,suggestionElm:C}).then((function(){C?_.dropdown.selectOption(C,n):_.dropdown.hide()})).catch((function(n){return O.warn(n)}))}},onScroll:function(n){var O=n.target,_=O.scrollTop/(O.scrollHeight-O.parentNode.clientHeight)*100;this.trigger("dropdown:scroll",{percentage:Math.round(_)})}}},refilter:function(n){n=n||this.state.dropdown.query||"",this.suggestedListItems=this.dropdown.filterListItems(n),this.dropdown.fill(),this.suggestedListItems.length||this.dropdown.hide(),this.trigger("dropdown:updated",this.DOM.dropdown)},getSuggestionDataByNode:function(n){for(var O,_=n&&n.getAttribute("value"),C=this.suggestedListItems.length;C--;){if(c(O=this.suggestedListItems[C])&&O.value==_)return O;if(O==_)return{value:O}}},getNextOrPrevOption:function(n){var O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],_=this.dropdown.getAllSuggestionsRefs(),C=_.findIndex((function(O){return O===n}));return O?_[C+1]:_[C-1]},highlightOption:function(n,O){var _,C=this.settings.classNames.dropdownItemActive;if(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(C),this.state.ddItemElm.removeAttribute("aria-selected")),!n)return this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this);_=this.dropdown.getSuggestionDataByNode(n),this.state.ddItemData=_,this.state.ddItemElm=n,n.classList.add(C),n.setAttribute("aria-selected",!0),O&&(n.parentNode.scrollTop=n.clientHeight+n.offsetTop-n.parentNode.clientHeight),this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,_),this.dropdown.position())},selectOption:function(n,O){var _=this,C=this.settings,A=C.dropdown,k=A.clearOnSelect,L=A.closeOnSelect;if(!n)return this.addTags(this.state.inputText,!0),void(L&&this.dropdown.hide());O=O||{};var j=n.getAttribute("value"),U="noMatch"==j,Q="mix"==C.mode,Y=this.suggestedListItems.find((function(n){var O;return(null!==(O=n.value)&&void 0!==O?O:n)==j}));if(this.trigger("dropdown:select",{data:Y,elm:n,event:O}),Y||U){if(this.state.editing){var Z=this.normalizeTags([Y])[0];Y=C.transformTag.call(this,Z)||Z,this.onEditTagDone(null,u({__isValid:!0},Y))}else this[Q?"addMixTags":"addTags"]([Y||this.input.raw.call(this)],k);(Q||this.DOM.input.parentNode)&&(setTimeout((function(){_.DOM.input.focus(),_.toggleFocusClass(!0)})),L&&setTimeout(this.dropdown.hide.bind(this)),n.addEventListener("transitionend",(function(){_.dropdown.fillHeaderFooter(),setTimeout((function(){n.remove(),_.dropdown.refilter()}),100)}),{once:!0}),n.classList.add(this.settings.classNames.dropdownItemHidden))}else L&&setTimeout(this.dropdown.hide.bind(this))},selectAll:function(n){this.suggestedListItems.length=0,this.dropdown.hide(),this.dropdown.filterListItems("");var O=this.dropdown.filterListItems("");return n||(O=this.state.dropdown.suggestions),this.addTags(O,!0),this},filterListItems:function(n,O){var _,C,A,k,L,j,l=function(){var n,U,Q=void 0,it=void 0;n=et[at],C=(null!=(U=Object)&&"undefined"!=typeof Symbol&&U[Symbol.hasInstance]?U[Symbol.hasInstance](n):n instanceof U)?et[at]:{value:et[at]};var nt,ot=Object.keys(C).some((function(n){return st.includes(n)}))?st:["value"];Y.fuzzySearch&&!O.exact?(k=ot.reduce((function(n,O){return n+" "+(C[O]||"")}),"").toLowerCase().trim(),Y.accentedSearch&&(k=h(k),j=h(j)),Q=0==k.indexOf(j),it=k===j,nt=k,A=j.toLowerCase().split(" ").every((function(n){return nt.includes(n.toLowerCase())}))):(Q=!0,A=ot.some((function(n){var _=""+(C[n]||"");return Y.accentedSearch&&(_=h(_),j=h(j)),Y.caseSensitive||(_=_.toLowerCase()),it=_===j,O.exact?_===j:0==_.indexOf(j)}))),L=!Y.includeSelectedTags&&_.isTagDuplicate(c(C)?C.value:C),A&&!L&&(it&&Q?tt.push(C):"startsWith"==Y.sortby&&Q?Z.unshift(C):Z.push(C))},U=this,Q=this.settings,Y=Q.dropdown,Z=(O=O||{},[]),tt=[],et=Q.whitelist,it=Y.maxItems>=0?Y.maxItems:1/0,nt=Y.includeSelectedTags||"select"==Q.mode,st=Y.searchKeys,at=0;if(!(n="select"==Q.mode&&this.value.length&&this.value[0][Q.tagTextProp]==n?"":n)||!st.length)return Z=nt?et:et.filter((function(n){return!U.isTagDuplicate(c(n)?n.value:n)})),this.state.dropdown.suggestions=Z,Z.slice(0,it);for(j=Y.caseSensitive?""+n:(""+n).toLowerCase();at<et.length;at++)_=this,l();return this.state.dropdown.suggestions=tt.concat(Z),"function"==typeof Y.sortby?Y.sortby(tt.concat(Z),j):tt.concat(Z).slice(0,it)},getMappedValue:function(n){var O=this.settings.dropdown.mapValueTo;return O?"function"==typeof O?O(n):n[O]||n.value:n.value},createListHTML:function(n){var O=this;return u([],n).map((function(n,_){"string"!=typeof n&&"number"!=typeof n||(n={value:n});var C=O.dropdown.getMappedValue(n);return C="string"==typeof C&&O.settings.dropdown.escapeHTML?d(C):C,O.settings.templates.dropdownItem.apply(O,[I(x({},n),{mappedValue:C}),O])})).join("")}}),A=null!=(A={refs:function(){this.DOM.dropdown=this.parseTemplate("dropdown",[this.settings]),this.DOM.dropdown.content=this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-wrapper']")},getHeaderRef:function(){return this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-header']")},getFooterRef:function(){return this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-footer']")},getAllSuggestionsRefs:function(){return M(this.DOM.dropdown.content.querySelectorAll(this.settings.classNames.dropdownItemSelector))},show:function(n){var O,_,C,A=this,k=this.settings,L="mix"==k.mode&&!k.enforceWhitelist,j=!k.whitelist||!k.whitelist.length,U="manual"==k.dropdown.position;if(n=void 0===n?this.state.inputText:n,!(j&&!L&&!k.templates.dropdownItemNoMatch||!1===k.dropdown.enabled||this.state.isLoading||this.settings.readonly)){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems(n),n&&!this.suggestedListItems.length&&(this.trigger("dropdown:noMatch",n),k.templates.dropdownItemNoMatch&&(C=k.templates.dropdownItemNoMatch.call(this,{value:n}))),!C){if(this.suggestedListItems.length)n&&L&&!this.state.editing.scope&&!s(this.suggestedListItems[0].value,n)&&this.suggestedListItems.unshift({value:n});else{if(!n||!L||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide();this.suggestedListItems=[{value:n}]}_=""+(c(O=this.suggestedListItems[0])?O.value:O),k.autoComplete&&_&&0==_.indexOf(n)&&this.input.autocomplete.suggest.call(this,O)}this.dropdown.fill(C),k.dropdown.highlightFirst&&this.dropdown.highlightOption(this.DOM.dropdown.content.querySelector(k.classNames.dropdownItemSelector)),this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this)),this.state.dropdown.visible=n||!0,this.state.dropdown.query=n,this.setStateSelection(),U||setTimeout((function(){A.dropdown.position(),A.dropdown.render()})),setTimeout((function(){A.trigger("dropdown:show",A.DOM.dropdown)}))}},hide:function(n){var O=this,_=this.DOM,C=_.scope,A=_.dropdown,k="manual"==this.settings.dropdown.position&&!n;if(A&&document.body.contains(A)&&!k)return window.removeEventListener("resize",this.dropdown.position),this.dropdown.events.binding.call(this,!1),C.setAttribute("aria-expanded",!1),A.parentNode.removeChild(A),setTimeout((function(){O.state.dropdown.visible=!1}),100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger("dropdown:hide",A),this},toggle:function(n){this.dropdown[this.state.dropdown.visible&&!n?"hide":"show"]()},getAppendTarget:function(){var n=this.settings.dropdown;return"function"==typeof n.appendTarget?n.appendTarget():n.appendTarget},render:function(){var n,O,_,C=this,A=(n=this.DOM.dropdown,(_=n.cloneNode(!0)).style.cssText="position:fixed; top:-9999px; opacity:0",document.body.appendChild(_),O=_.clientHeight,_.parentNode.removeChild(_),O),k=this.settings,L=this.dropdown.getAppendTarget();return!1===k.dropdown.enabled||(this.DOM.scope.setAttribute("aria-expanded",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(k.classNames.dropdownInital),this.dropdown.position(A),L.appendChild(this.DOM.dropdown),setTimeout((function(){return C.DOM.dropdown.classList.remove(k.classNames.dropdownInital)})))),this},fill:function(n){n="string"==typeof n?n:this.dropdown.createListHTML(n||this.suggestedListItems);var O,_=this.settings.templates.dropdownContent.call(this,n);this.DOM.dropdown.content.innerHTML=(O=_)?O.replace(/\>[\r\n ]+\</g,"><").split(/>\s+</).join("><").trim():""},fillHeaderFooter:function(){var n=this.dropdown.filterListItems(this.state.dropdown.query),O=this.parseTemplate("dropdownHeader",[n]),_=this.parseTemplate("dropdownFooter",[n]),C=this.dropdown.getHeaderRef(),A=this.dropdown.getFooterRef();O&&(null==C||C.parentNode.replaceChild(O,C)),_&&(null==A||A.parentNode.replaceChild(_,A))},position:function(n){var O=this.settings.dropdown,_=this.dropdown.getAppendTarget();if("manual"!=O.position&&_){var C,A,k,L,j,U,Q,Y,Z,tt=this.DOM.dropdown,et=O.RTL,it=_===document.body,nt=_===this.DOM.scope,st=it?window.pageYOffset:_.scrollTop,at=document.fullscreenElement||document.webkitFullscreenElement||document.documentElement,ot=at.clientHeight,rt=Math.max(at.clientWidth||0,window.innerWidth||0)>480?O.position:"all",lt=this.DOM["input"==rt?"input":"scope"];if(n=n||tt.clientHeight,this.state.dropdown.visible){if("text"==rt?(k=(C=function(){var n=document.getSelection();if(n.rangeCount){var O,_,C=n.getRangeAt(0),A=C.startContainer,k=C.startOffset;if(k>0)return(_=document.createRange()).setStart(A,k-1),_.setEnd(A,k),{left:(O=_.getBoundingClientRect()).right,top:O.top,bottom:O.bottom};if(A.getBoundingClientRect)return A.getBoundingClientRect()}return{left:-9999,top:-9999}}()).bottom,A=C.top,L=C.left,j="auto"):(U=function(n){var O=0,_=0;for(n=n.parentNode;n&&n!=at;)O+=n.offsetTop||0,_+=n.offsetLeft||0,n=n.parentNode;return{top:O,left:_}}(_),C=lt.getBoundingClientRect(),A=nt?-1:C.top-U.top,k=(nt?C.height:C.bottom-U.top)-1,L=nt?-1:C.left-U.left,j=C.width+"px"),!it){var dt=function(){for(var n=0,_=O.appendTarget.parentNode;_;)n+=_.scrollTop||0,_=_.parentNode;return n}();A+=dt,k+=dt}var ct;A=Math.floor(A),k=Math.ceil(k),Y=((Q=null!==(ct=O.placeAbove)&&void 0!==ct?ct:ot-C.bottom<n)?A:k)+st,Z="left: ".concat(L+(et&&C.width||0)+window.pageXOffset,"px;"),tt.style.cssText="".concat(Z,"; top: ").concat(Y,"px; min-width: ").concat(j,"; max-width: ").concat(j),tt.setAttribute("placement",Q?"top":"bottom"),tt.setAttribute("position",rt)}}}})?A:{},Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(A)):function(n,O){var _=Object.keys(n);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(n);O&&(C=C.filter((function(O){return Object.getOwnPropertyDescriptor(n,O).enumerable}))),_.push.apply(_,C)}return _}(Object(A)).forEach((function(n){Object.defineProperty(C,n,Object.getOwnPropertyDescriptor(A,n))})),C),L="@yaireo/tagify/",j={empty:"empty",exceed:"number of tags exceeded",pattern:"pattern mismatch",duplicate:"already exists",notAllowed:"not allowed"},U={wrapper:function(O,_){return'<tags class="'.concat(_.classNames.namespace," ").concat(_.mode?"".concat(_.classNames[_.mode+"Mode"]):""," ").concat(O.className,'"\n                    ').concat(_.readonly?"readonly":"","\n                    ").concat(_.disabled?"disabled":"","\n                    ").concat(_.required?"required":"","\n                    ").concat("select"===_.mode?"spellcheck='false'":"",'\n                    tabIndex="-1">\n                    ').concat(this.settings.templates.input.call(this),"\n                ").concat(n,"\n        </tags>")},input:function(){var O=this.settings,_=O.placeholder||n;return"<span ".concat(!O.readonly&&O.userInput?"contenteditable":"",' tabIndex="0" data-placeholder="').concat(_,'" aria-placeholder="').concat(O.placeholder||"",'"\n                    class="').concat(O.classNames.input,'"\n                    role="textbox"\n                    autocapitalize="false"\n                    autocorrect="off"\n                    aria-autocomplete="both"\n                    aria-multiline="').concat("mix"==O.mode,'"></span>')},tag:function(n,O){var _=O.settings;return'<tag title="'.concat(n.title||n.value,"\"\n                    contenteditable='false'\n                    tabIndex=\"").concat(_.a11y.focusableTags?0:-1,'"\n                    class="').concat(_.classNames.tag," ").concat(n.class||"",'"\n                    ').concat(this.getAttributes(n),">\n            <x title='' tabIndex=\"").concat(_.a11y.focusableTags?0:-1,'" class="').concat(_.classNames.tagX,"\" role='button' aria-label='remove tag'></x>\n            <div>\n                <span ").concat("select"===_.mode&&_.userInput?"contenteditable='true'":"",' autocapitalize="false" autocorrect="off" spellcheck=\'false\' class="').concat(_.classNames.tagText,'">').concat(n[_.tagTextProp]||n.value,"</span>\n            </div>\n        </tag>")},dropdown:function(n){var O=n.dropdown,_="manual"==O.position;return'<div class="'.concat(_?"":n.classNames.dropdown," ").concat(O.classname,'" role="listbox" aria-labelledby="dropdown" dir="').concat(O.RTL?"rtl":"","\">\n                    <div data-selector='tagify-suggestions-wrapper' class=\"").concat(n.classNames.dropdownWrapper,'"></div>\n                </div>')},dropdownContent:function(n){var O=this.settings.templates,_=this.state.dropdown.suggestions;return"\n            ".concat(O.dropdownHeader.call(this,_),"\n            ").concat(n,"\n            ").concat(O.dropdownFooter.call(this,_),"\n        ")},dropdownItem:function(n){return"<div ".concat(this.getAttributes(n),"\n                    class='").concat(this.settings.classNames.dropdownItem," ").concat(this.isTagDuplicate(n.value)?this.settings.classNames.dropdownItemSelected:""," ").concat(n.class||"",'\'\n                    tabindex="0"\n                    role="option">').concat(n.mappedValue||n.value,"</div>")},dropdownHeader:function(n){return"<header data-selector='tagify-suggestions-header' class=\"".concat(this.settings.classNames.dropdownHeader,'"></header>')},dropdownFooter:function(n){var O=n.length-this.settings.dropdown.maxItems;return O>0?"<footer data-selector='tagify-suggestions-footer' class=\"".concat(this.settings.classNames.dropdownFooter,'">\n                ').concat(O," more items. Refine your search.\n            </footer>"):""},dropdownItemNoMatch:null};function P(n,O){(null==O||O>n.length)&&(O=n.length);for(var _=0,C=new Array(O);_<O;_++)C[_]=n[_];return C}function V(n,O){return null!=O&&"undefined"!=typeof Symbol&&O[Symbol.hasInstance]?!!O[Symbol.hasInstance](n):n instanceof O}function F(n,O){return function(n){if(Array.isArray(n))return n}(n)||function(n,O){var _=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=_){var C,A,k=[],L=!0,j=!1;try{for(_=_.call(n);!(L=(C=_.next()).done)&&(k.push(C.value),!O||k.length!==O);L=!0);}catch(n){j=!0,A=n}finally{try{L||null==_.return||_.return()}finally{if(j)throw A}}return k}}(n,O)||function(n,O){if(n){if("string"==typeof n)return P(n,O);var _=Object.prototype.toString.call(n).slice(8,-1);"Object"===_&&n.constructor&&(_=n.constructor.name);return"Map"===_||"Set"===_?Array.from(_):"Arguments"===_||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_)?P(n,O):void 0}}(n,O)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(n,O){(null==O||O>n.length)&&(O=n.length);for(var _=0,C=new Array(O);_<O;_++)C[_]=n[_];return C}function H(n,O,_){return O in n?Object.defineProperty(n,O,{value:_,enumerable:!0,configurable:!0,writable:!0}):n[O]=_,n}function B(n,O){return null!=O&&"undefined"!=typeof Symbol&&O[Symbol.hasInstance]?!!O[Symbol.hasInstance](n):n instanceof O}function W(n,O){return O=null!=O?O:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(O)):function(n,O){var _=Object.keys(n);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(n);O&&(C=C.filter((function(O){return Object.getOwnPropertyDescriptor(n,O).enumerable}))),_.push.apply(_,C)}return _}(Object(O)).forEach((function(_){Object.defineProperty(n,_,Object.getOwnPropertyDescriptor(O,_))})),n}function K(n){return function(n){if(Array.isArray(n))return R(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||function(n,O){if(n){if("string"==typeof n)return R(n,O);var _=Object.prototype.toString.call(n).slice(8,-1);"Object"===_&&n.constructor&&(_=n.constructor.name);return"Map"===_||"Set"===_?Array.from(_):"Arguments"===_||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_)?R(n,O):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Q={customBinding:function(){var n=this;this.customEventsList.forEach((function(O){n.on(O,n.settings.callbacks[O])}))},binding:function(){var n,O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],_=this.settings,C=this.events.callbacks,A=O?"addEventListener":"removeEventListener";if(!this.state.mainEvents||!O){for(var k in this.state.mainEvents=O,O&&!this.listeners.main&&(this.events.bindGlobal.call(this),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this))),n=this.listeners.main=this.listeners.main||{keydown:["input",C.onKeydown.bind(this)],click:["scope",C.onClickScope.bind(this)],dblclick:"select"!=_.mode&&["scope",C.onDoubleClickScope.bind(this)],paste:["input",C.onPaste.bind(this)],drop:["input",C.onDrop.bind(this)],compositionstart:["input",C.onCompositionStart.bind(this)],compositionend:["input",C.onCompositionEnd.bind(this)]})n[k]&&this.DOM[n[k][0]][A](k,n[k][1]);var L=this.listeners.main.inputMutationObserver||new MutationObserver(C.onInputDOMChange.bind(this));L.disconnect(),"mix"==_.mode&&L.observe(this.DOM.input,{childList:!0}),this.events.bindOriginaInputListener.call(this)}},bindOriginaInputListener:function(n){var O=(n||0)+500;this.listeners.main&&(clearInterval(this.listeners.main.originalInputValueObserverInterval),this.listeners.main.originalInputValueObserverInterval=setInterval(this.events.callbacks.observeOriginalInputValue.bind(this),O))},bindGlobal:function(n){var O,_=this.events.callbacks,C=n?"removeEventListener":"addEventListener";if(this.listeners&&(n||!this.listeners.global)){this.listeners.global=this.listeners.global||[{type:this.isIE?"keydown":"input",target:this.DOM.input,cb:_[this.isIE?"onInputIE":"onInput"].bind(this)},{type:"keydown",target:window,cb:_.onWindowKeyDown.bind(this)},{type:"focusin",target:this.DOM.scope,cb:_.onFocusBlur.bind(this)},{type:"focusout",target:this.DOM.scope,cb:_.onFocusBlur.bind(this)},{type:"click",target:document,cb:_.onClickAnywhere.bind(this),useCapture:!0}];var A=!0,k=!1,L=void 0;try{for(var j,U=this.listeners.global[Symbol.iterator]();!(A=(j=U.next()).done);A=!0)(O=j.value).target[C](O.type,O.cb,!!O.useCapture)}catch(n){k=!0,L=n}finally{try{A||null==U.return||U.return()}finally{if(k)throw L}}}},unbindGlobal:function(){this.events.bindGlobal.call(this,!0)},callbacks:{onFocusBlur:function(n){var O,_,C=this.settings,A=v.call(this,n.target),k=m.call(this,n.target),L=n.target.classList.contains(C.classNames.tagX),j="focusin"==n.type,U="focusout"==n.type;A&&j&&!k&&!L&&this.toggleFocusClass(this.state.hasFocus=+new Date);var Q=n.target?this.trim(this.DOM.input.textContent):"",Y=null===(_=this.value)||void 0===_||null===(O=_[0])||void 0===O?void 0:O[C.tagTextProp],Z=C.dropdown.enabled>=0,tt={relatedTarget:n.relatedTarget},et=this.state.actions.selectOption&&(Z||!C.dropdown.closeOnSelect),it=this.state.actions.addNew&&Z;if(U){if(n.relatedTarget===this.DOM.scope)return this.dropdown.hide(),void this.DOM.input.focus();this.postUpdate(),C.onChangeAfterBlur&&this.triggerChangeEvent()}if(!(et||it||L))if(j||A?(this.state.hasFocus=+new Date,this.toggleFocusClass(this.state.hasFocus)):this.state.hasFocus=!1,"mix"!=C.mode){if(j){if(!C.focusable)return;var nt=0===C.dropdown.enabled&&!this.state.dropdown.visible,st=!k||"select"===C.mode;return this.toggleFocusClass(!0),this.trigger("focus",tt),void(nt&&st&&this.dropdown.show(this.value.length?"":void 0))}if(U){if(this.trigger("blur",tt),this.loading(!1),"select"==C.mode){if(this.value.length){var at=this.getTagElms()[0];Q=this.trim(at.textContent)}Y===Q&&(Q="")}Q&&!this.state.actions.selectOption&&C.addTagOnBlur&&C.addTagOn.includes("blur")&&this.addTags(Q,!0)}A||(this.DOM.input.removeAttribute("style"),this.dropdown.hide())}else j?this.trigger("focus",tt):U&&(this.trigger("blur",tt),this.loading(!1),this.dropdown.hide(),this.state.dropdown.visible=void 0,this.setStateSelection())},onCompositionStart:function(n){this.state.composing=!0},onCompositionEnd:function(n){this.state.composing=!1},onWindowKeyDown:function(n){var O,_=this.settings,C=document.activeElement,A=v.call(this,C)&&this.DOM.scope.contains(C),k=C===this.DOM.input,L=A&&C.hasAttribute("readonly");if((this.state.hasFocus||A&&!L)&&!k){O=C.nextElementSibling;var j=n.target.classList.contains(_.classNames.tagX);switch(n.key){case"Backspace":_.readonly||this.state.editing||(this.removeTags(C),(O||this.DOM.input).focus());break;case"Enter":if(j)return void this.removeTags(n.target.parentNode);_.a11y.focusableTags&&m.call(this,C)&&setTimeout(this.editTag.bind(this),0,C);break;case"ArrowDown":this.state.dropdown.visible||"mix"==_.mode||this.dropdown.show()}}},onKeydown:function(n){var O=this,_=this.settings;if(!this.state.composing&&_.userInput){"select"==_.mode&&_.enforceWhitelist&&this.value.length&&"Tab"!=n.key&&n.preventDefault();var C=this.trim(n.target.textContent);this.trigger("keydown",{event:n}),_.hooks.beforeKeyDown(n,{tagify:this}).then((function(A){if("mix"==_.mode){switch(n.key){case"Left":case"ArrowLeft":O.state.actions.ArrowLeft=!0;break;case"Delete":case"Backspace":if(O.state.editing)return;var k=document.getSelection(),L="Delete"==n.key&&k.anchorOffset==(k.anchorNode.length||0),j=k.anchorNode.previousSibling,U=1==k.anchorNode.nodeType||!k.anchorOffset&&j&&1==j.nodeType&&k.anchorNode.previousSibling;!function(n){var O=document.createElement("div");n.replace(/\&#?[0-9a-z]+;/gi,(function(n){return O.innerHTML=n,O.innerText}))}(O.DOM.input.innerHTML);var Q,Y,Z,tt=O.getTagElms(),et=1===k.anchorNode.length&&k.anchorNode.nodeValue==String.fromCharCode(8203);if("edit"==_.backspace&&U)return Q=1==k.anchorNode.nodeType?null:k.anchorNode.previousElementSibling,setTimeout(O.editTag.bind(O),0,Q),void n.preventDefault();if(p()&&B(U,Element))return Z=l(U),U.hasAttribute("readonly")||U.remove(),O.DOM.input.focus(),void setTimeout((function(){y(Z),O.DOM.input.click()}));if("BR"==k.anchorNode.nodeName)return;if((L||U)&&1==k.anchorNode.nodeType?Y=0==k.anchorOffset?L?tt[0]:null:tt[Math.min(tt.length,k.anchorOffset)-1]:L?Y=k.anchorNode.nextElementSibling:B(U,Element)&&(Y=U),3==k.anchorNode.nodeType&&!k.anchorNode.nodeValue&&k.anchorNode.previousElementSibling&&n.preventDefault(),(U||L)&&!_.backspace)return void n.preventDefault();if("Range"!=k.type&&!k.anchorOffset&&k.anchorNode==O.DOM.input&&"Delete"!=n.key)return void n.preventDefault();if("Range"!=k.type&&Y&&Y.hasAttribute("readonly"))return void y(l(Y));"Delete"==n.key&&et&&w(k.anchorNode.nextSibling)&&O.removeTags(k.anchorNode.nextSibling)}return!0}var it="manual"==_.dropdown.position;switch(n.key){case"Backspace":"select"==_.mode&&_.enforceWhitelist&&O.value.length?O.removeTags():O.state.dropdown.visible&&"manual"!=_.dropdown.position||""!=n.target.textContent&&8203!=C.charCodeAt(0)||(!0===_.backspace?O.removeTags():"edit"==_.backspace&&setTimeout(O.editTag.bind(O),0));break;case"Esc":case"Escape":if(O.state.dropdown.visible)return;n.target.blur();break;case"Down":case"ArrowDown":O.state.dropdown.visible||O.dropdown.show();break;case"ArrowRight":var nt=O.state.inputSuggestion||O.state.ddItemData;if(nt&&_.autoComplete.rightKey)return void O.addTags([nt],!0);break;case"Tab":var st="select"==_.mode;if(!C||st)return!0;n.preventDefault();case"Enter":if(O.state.dropdown.visible&&!it)return;n.preventDefault();var at=O.state.autoCompleteData||C;setTimeout((function(){O.state.dropdown.visible&&!it||O.state.actions.selectOption||!_.addTagOn.includes(n.key.toLowerCase())||(O.addTags([at],!0),O.state.autoCompleteData=null)}))}})).catch((function(n){return n}))}},onInput:function(n){this.postUpdate();var O=this.settings;if("mix"==O.mode)return this.events.callbacks.onMixTagsInput.call(this,n);var _=this.input.normalize.call(this,void 0,{trim:!1}),C=_.length>=O.dropdown.enabled,A={value:_,inputElm:this.DOM.input},k=this.validateTag({value:_});"select"==O.mode&&this.toggleScopeValidation(k),A.isValid=k,this.state.inputText!=_&&(this.input.set.call(this,_,!1),-1!=_.search(O.delimiters)?this.addTags(_)&&this.input.set.call(this):O.dropdown.enabled>=0&&this.dropdown[C?"show":"hide"](_),this.trigger("input",A))},onMixTagsInput:function(n){var O,_,C,A,k,L,j,U,Q=this,Y=this.settings,Z=this.value.length,tt=this.getTagElms(),et=document.createDocumentFragment(),it=window.getSelection().getRangeAt(0),nt=[].map.call(tt,(function(n){return w(n).value}));if("deleteContentBackward"==n.inputType&&p()&&this.events.callbacks.onKeydown.call(this,{target:n.target,key:"Backspace"}),T(this.getTagElms()),this.value.slice().forEach((function(n){n.readonly&&!nt.includes(n.value)&&et.appendChild(Q.createTagElem(n))})),et.childNodes.length&&(it.insertNode(et),this.setRangeAtStartEnd(!1,et.lastChild)),tt.length!=Z)return this.value=[].map.call(this.getTagElms(),(function(n){return w(n)})),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&(L=window.getSelection()).rangeCount>0&&3==L.anchorNode.nodeType){if((it=L.getRangeAt(0).cloneRange()).collapse(!0),it.setStart(L.focusNode,0),C=(O=it.toString().slice(0,it.endOffset)).split(Y.pattern).length-1,(_=O.match(Y.pattern))&&(A=O.slice(O.lastIndexOf(_[_.length-1]))),A){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:A.match(Y.pattern)[0],value:A.replace(Y.pattern,"")},this.state.tag.baseOffset=L.baseOffset-this.state.tag.value.length,U=this.state.tag.value.match(Y.delimiters))return this.state.tag.value=this.state.tag.value.replace(Y.delimiters,""),this.state.tag.delimiters=U[0],this.addTags(this.state.tag.value,Y.dropdown.clearOnSelect),void this.dropdown.hide();k=this.state.tag.value.length>=Y.dropdown.enabled;try{j=(j=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&j.value[0]==this.state.tag.value[0],this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch(n){}(j||C<this.state.mixMode.matchedPatternCount)&&(k=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=C}setTimeout((function(){Q.update({withoutChangeEvent:!0}),Q.trigger("input",u({},Q.state.tag,{textContent:Q.DOM.input.textContent})),Q.state.tag&&Q.dropdown[k?"show":"hide"](Q.state.tag.value)}),10)},onInputIE:function(n){var O=this;setTimeout((function(){O.events.callbacks.onInput.call(O,n)}))},observeOriginalInputValue:function(){this.DOM.originalInput.parentNode||this.destroy(),this.DOM.originalInput.value!=this.DOM.originalInput.tagifyValue&&this.loadOriginalValues()},onClickAnywhere:function(n){n.target==this.DOM.scope||this.DOM.scope.contains(n.target)||(this.toggleFocusClass(!1),this.state.hasFocus=!1,n.target.closest(".tagify__dropdown")&&n.target.closest(".tagify__dropdown").__tagify!=this&&this.dropdown.hide())},onClickScope:function(n){var O=this.settings,_=n.target.closest("."+O.classNames.tag),C=n.target===this.DOM.scope,A=+new Date-this.state.hasFocus;if(C&&"select"!=O.mode)this.DOM.input.focus();else{if(!n.target.classList.contains(O.classNames.tagX))return _&&!this.state.editing?(this.trigger("click",{tag:_,index:this.getNodeIndex(_),data:w(_),event:n}),void(1!==O.editTags&&1!==O.editTags.clicks&&"select"!=O.mode||this.events.callbacks.onDoubleClickScope.call(this,n))):void(n.target==this.DOM.input&&("mix"==O.mode&&this.fixFirefoxLastTagNoCaret(),A>500||!O.focusable)?this.state.dropdown.visible?this.dropdown.hide():0===O.dropdown.enabled&&"mix"!=O.mode&&this.dropdown.show(this.value.length?"":void 0):"select"!=O.mode||0!==O.dropdown.enabled||this.state.dropdown.visible||(this.events.callbacks.onDoubleClickScope.call(this,W(function(n){for(var O=1;O<arguments.length;O++){var _=null!=arguments[O]?arguments[O]:{},C=Object.keys(_);"function"==typeof Object.getOwnPropertySymbols&&(C=C.concat(Object.getOwnPropertySymbols(_).filter((function(n){return Object.getOwnPropertyDescriptor(_,n).enumerable})))),C.forEach((function(O){H(n,O,_[O])}))}return n}({},n),{target:this.getTagElms()[0]})),!O.userInput&&this.dropdown.show()));this.removeTags(n.target.parentNode)}},onPaste:function(n){var O=this;n.preventDefault();var _,C,A,k=this.settings;if("select"==k.mode&&k.enforceWhitelist||!k.userInput)return!1;k.readonly||(C=n.clipboardData||window.clipboardData,A=C.getData("Text"),k.hooks.beforePaste(n,{tagify:this,pastedText:A,clipboardData:C}).then((function(k){void 0===k&&(k=A),k&&(O.injectAtCaret(k,window.getSelection().getRangeAt(0)),"mix"==O.settings.mode?O.events.callbacks.onMixTagsInput.call(O,n):O.settings.pasteAsTags?_=O.addTags(O.state.inputText+k,!0):(O.state.inputText=k,O.dropdown.show(k))),O.trigger("paste",{event:n,pastedText:A,clipboardData:C,tagsElems:_})})).catch((function(n){return n})))},onDrop:function(n){n.preventDefault()},onEditTagInput:function(n,O){var _,C=n.closest("."+this.settings.classNames.tag),A=this.getNodeIndex(C),k=w(C),L=this.input.normalize.call(this,n),j=(H(_={},this.settings.tagTextProp,L),H(_,"__tagId",k.__tagId),_),U=this.validateTag(j);this.editTagChangeDetected(u(k,j))||!0!==n.originalIsValid||(U=!0),C.classList.toggle(this.settings.classNames.tagInvalid,!0!==U),k.__isValid=U,C.title=!0===U?k.title||k.value:U,L.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=L),this.dropdown.show(L)),this.trigger("edit:input",{tag:C,index:A,data:u({},this.value[A],{newValue:L}),event:O})},onEditTagPaste:function(n,O){var _=(O.clipboardData||window.clipboardData).getData("Text");O.preventDefault();var C=b(_);this.setRangeAtStartEnd(!1,C)},onEditTagClick:function(n,O){this.events.callbacks.onClickScope.call(this,O)},onEditTagFocus:function(n){this.state.editing={scope:n,input:n.querySelector("[contenteditable]")}},onEditTagBlur:function(n,O){var _=m.call(this,O.relatedTarget);if("select"==this.settings.mode&&_&&O.relatedTarget.contains(O.target))this.dropdown.hide();else if(this.state.editing&&(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(document.activeElement)||this.trigger("blur",{}),this.DOM.scope.contains(n))){var C,A,k,L=this.settings,j=n.closest("."+L.classNames.tag),U=w(j),Q=this.input.normalize.call(this,n),Y=(H(C={},L.tagTextProp,Q),H(C,"__tagId",U.__tagId),C),Z=U.__originalData,tt=this.editTagChangeDetected(u(U,Y)),et=this.validateTag(Y);if(Q)if(tt){var it;if(A=this.hasMaxTags(),k=u({},Z,(H(it={},L.tagTextProp,this.trim(Q)),H(it,"__isValid",et),it)),L.transformTag.call(this,k,Z),!0!==(et=(!A||!0===Z.__isValid)&&this.validateTag(k))){if(this.trigger("invalid",{data:k,tag:j,message:et}),L.editTags.keepInvalid)return;L.keepInvalidTags?k.__isValid=et:k=Z}else L.keepInvalidTags&&(delete k.title,delete k["aria-invalid"],delete k.class);this.onEditTagDone(j,k)}else this.onEditTagDone(j,Z);else this.onEditTagDone(j)}},onEditTagkeydown:function(n,O){if(!this.state.composing)switch(this.trigger("edit:keydown",{event:n}),n.key){case"Esc":case"Escape":this.state.editing=!1,!O.__tagifyTagData.__originalData.value?O.remove():O.parentNode.replaceChild(O.__tagifyTagData.__originalHTML,O);break;case"Enter":case"Tab":n.preventDefault();setTimeout((function(){return n.target.blur()}),0)}},onDoubleClickScope:function(n){var O,_,C=n.target.closest("."+this.settings.classNames.tag),A=w(C),k=this.settings;C&&!1!==A.editable&&(O=C.classList.contains(this.settings.classNames.tagEditing),_=C.hasAttribute("readonly"),k.readonly||O||_||!this.settings.editTags||!k.userInput||(this.events.callbacks.onEditTagFocus.call(this,C),this.editTag(C)),this.toggleFocusClass(!0),"select"!=k.mode&&this.trigger("dblclick",{tag:C,index:this.getNodeIndex(C),data:w(C)}))},onInputDOMChange:function(n){var O=this;n.forEach((function(n){n.addedNodes.forEach((function(n){if("<div><br></div>"==n.outerHTML)n.replaceWith(document.createElement("br"));else if(1==n.nodeType&&n.querySelector(O.settings.classNames.tagSelector)){var _,C=document.createTextNode("");3==n.childNodes[0].nodeType&&"BR"!=n.previousSibling.nodeName&&(C=document.createTextNode("\n")),(_=n).replaceWith.apply(_,K([C].concat(K(K(n.childNodes).slice(0,-1))))),y(C)}else if(m.call(O,n)){var A;if(3!=(null===(A=n.previousSibling)||void 0===A?void 0:A.nodeType)||n.previousSibling.textContent||n.previousSibling.remove(),n.previousSibling&&"BR"==n.previousSibling.nodeName){n.previousSibling.replaceWith("\n​");for(var k=n.nextSibling,L="";k;)L+=k.textContent,k=k.nextSibling;L.trim()&&y(n.previousSibling)}else n.previousSibling&&!w(n.previousSibling)||n.before("​")}})),n.removedNodes.forEach((function(n){n&&"BR"==n.nodeName&&m.call(O,_)&&(O.removeTags(_),O.fixFirefoxLastTagNoCaret())}))}));var _=this.DOM.input.lastChild;_&&""==_.nodeValue&&_.remove(),_&&"BR"==_.nodeName||this.DOM.input.appendChild(document.createElement("br"))}}};function q(n,O){(null==O||O>n.length)&&(O=n.length);for(var _=0,C=new Array(O);_<O;_++)C[_]=n[_];return C}function z(n,O,_){return O in n?Object.defineProperty(n,O,{value:_,enumerable:!0,configurable:!0,writable:!0}):n[O]=_,n}function X(n,O){return null!=O&&"undefined"!=typeof Symbol&&O[Symbol.hasInstance]?!!O[Symbol.hasInstance](n):n instanceof O}function J(n){for(var O=1;O<arguments.length;O++){var _=null!=arguments[O]?arguments[O]:{},C=Object.keys(_);"function"==typeof Object.getOwnPropertySymbols&&(C=C.concat(Object.getOwnPropertySymbols(_).filter((function(n){return Object.getOwnPropertyDescriptor(_,n).enumerable})))),C.forEach((function(O){z(n,O,_[O])}))}return n}function G(n){return function(n){if(Array.isArray(n))return q(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||function(n,O){if(n){if("string"==typeof n)return q(n,O);var _=Object.prototype.toString.call(n).slice(8,-1);"Object"===_&&n.constructor&&(_=n.constructor.name);return"Map"===_||"Set"===_?Array.from(_):"Arguments"===_||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_)?q(n,O):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(n,_){if(!n){O.warn("input element not found",n);var C=new Proxy(this,{get:function(){return function(){return C}}});return C}if(n.__tagify)return O.warn("input element is already Tagified - Same instance is returned.",n),n.__tagify;var A;u(this,function(n){var _=document.createTextNode(""),C={};function s(n,O,C){C&&O.split(/\s+/g).forEach((function(O){return _[n+"EventListener"].call(_,O,C)}))}return{removeAllCustomListeners:function(){Object.entries(C).forEach((function(n){var O=F(n,2),_=O[0];O[1].forEach((function(n){return s("remove",_,n)}))})),C={}},off:function(n,O){return n&&(O?s("remove",n,O):n.split(/\s+/g).forEach((function(n){var O;null===(O=C[n])||void 0===O||O.forEach((function(O){return s("remove",n,O)})),delete C[n]}))),this},on:function(n,O){return O&&"function"==typeof O&&(n.split(/\s+/g).forEach((function(n){Array.isArray(C[n])?C[n].push(O):C[n]=[O]})),s("add",n,O)),this},trigger:function(C,A,k){var L;if(k=k||{cloneData:!0},C)if(n.settings.isJQueryPlugin)"remove"==C&&(C="removeTag"),jQuery(n.DOM.originalInput).triggerHandler(C,[A]);else{try{var j="object"==typeof A?A:{value:A};if((j=k.cloneData?u({},j):j).tagify=this,A.event&&(j.event=this.cloneEvent(A.event)),V(A,Object))for(var U in A)V(A[U],HTMLElement)&&(j[U]=A[U]);L=new CustomEvent(C,{detail:j})}catch(n){O.warn(n)}_.dispatchEvent(L)}}}}(this)),this.isFirefox=/firefox|fxios/i.test(navigator.userAgent)&&!/seamonkey/i.test(navigator.userAgent),this.isIE=window.document.documentMode,_=_||{},this.getPersistedData=(A=_.id,function(n){var O;if(A){var _,C="/"+n;if(1===(null===(O=localStorage)||void 0===O?void 0:O.getItem(L+A+"/v")))try{_=JSON.parse(localStorage[L+A+C])}catch(n){}return _}}),this.setPersistedData=function(n){var O;return n?(null===(O=localStorage)||void 0===O||O.setItem(L+n+"/v",1),function(O,_){var C,A="/"+_,k=JSON.stringify(O);O&&_&&(null===(C=localStorage)||void 0===C||C.setItem(L+n+A,k),dispatchEvent(new Event("storage")))}):function(){}}(_.id),this.clearPersistedData=function(n){return function(O){var _=L+"/"+n+"/";if(O)localStorage.removeItem(_+O);else for(var C in localStorage)C.includes(_)&&localStorage.removeItem(C)}}(_.id),this.applySettings(n,_),this.state={inputText:"",editing:!1,composing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},this.value=[],this.listeners={},this.DOM={},this.build(n),N.call(this),this.getCSSVars(),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),n.autofocus&&this.DOM.input.focus(),n.__tagify=this}$.prototype={_dropdown:k,placeCaretAfterNode:y,getSetTagData:w,helpers:{sameStr:s,removeCollectionProp:a,omit:o,isObject:c,parseHTML:r,escapeHTML:d,extend:u,concatWithoutDups:g,getUID:f,isNodeTag:m},customEventsList:["change","add","remove","invalid","input","paste","click","keydown","focus","blur","edit:input","edit:beforeUpdate","edit:updated","edit:start","edit:keydown","dropdown:show","dropdown:hide","dropdown:select","dropdown:updated","dropdown:noMatch","dropdown:scroll"],dataProps:["__isValid","__removed","__originalData","__originalHTML","__tagId"],trim:function(n){return this.settings.trim&&n&&"string"==typeof n?n.trim():n},parseHTML:r,templates:U,parseTemplate:function(n,O){return r((n=this.settings.templates[n]||n).apply(this,O))},set whitelist(n){var O=n&&Array.isArray(n);this.settings.whitelist=O?n:[],this.setPersistedData(O?n:[],"whitelist")},get whitelist(){return this.settings.whitelist},set userInput(n){this.settings.userInput=!!n,this.setContentEditable(!!n)},get userInput(){return this.settings.userInput},generateClassSelectors:function(n){var e=function(O){var _=O;Object.defineProperty(n,_+"Selector",{get:function(){return"."+this[_].split(" ")[0]}})};for(var O in n)e(O)},applySettings:function(n,O){var C,A;_.templates=this.templates;var k=u({},_,"mix"==O.mode?{dropdown:{position:"text"}}:{}),L=this.settings=u({},k,O);if(L.disabled=n.hasAttribute("disabled"),L.readonly=L.readonly||n.hasAttribute("readonly"),L.placeholder=d(n.getAttribute("placeholder")||L.placeholder||""),L.required=n.hasAttribute("required"),this.generateClassSelectors(L.classNames),void 0===L.dropdown.includeSelectedTags&&(L.dropdown.includeSelectedTags=L.duplicates),this.isIE&&(L.autoComplete=!1),["whitelist","blacklist"].forEach((function(O){var _=n.getAttribute("data-"+O);_&&X(_=_.split(L.delimiters),Array)&&(L[O]=_)})),"autoComplete"in O&&!c(O.autoComplete)&&(L.autoComplete=_.autoComplete,L.autoComplete.enabled=O.autoComplete),"mix"==L.mode&&(L.pattern=L.pattern||/@/,L.autoComplete.rightKey=!0,L.delimiters=O.delimiters||null,L.tagTextProp&&!L.dropdown.searchKeys.includes(L.tagTextProp)&&L.dropdown.searchKeys.push(L.tagTextProp)),n.pattern)try{L.pattern=new RegExp(n.pattern)}catch(n){}if(L.delimiters){L._delimiters=L.delimiters;try{L.delimiters=new RegExp(this.settings.delimiters,"g")}catch(n){}}L.disabled&&(L.userInput=!1),this.TEXTS=J({},j,L.texts||{}),("select"!=L.mode||(null===(C=O.dropdown)||void 0===C?void 0:C.enabled))&&L.userInput||(L.dropdown.enabled=0),L.dropdown.appendTarget=(null===(A=O.dropdown)||void 0===A?void 0:A.appendTarget)||document.body;var U=this.getPersistedData("whitelist");Array.isArray(U)&&(this.whitelist=Array.isArray(L.whitelist)?g(L.whitelist,U):U)},getAttributes:function(n){var O,_=this.getCustomAttributes(n),C="";for(O in _)C+=" "+O+(void 0!==n[O]?'="'.concat(_[O],'"'):"");return C},getCustomAttributes:function(n){if(!c(n))return"";var O,_={};for(O in n)"__"!=O.slice(0,2)&&"class"!=O&&n.hasOwnProperty(O)&&void 0!==n[O]&&(_[O]=d(n[O]));return _},setStateSelection:function(){var n=window.getSelection(),O={anchorOffset:n.anchorOffset,anchorNode:n.anchorNode,range:n.getRangeAt&&n.rangeCount&&n.getRangeAt(0)};return this.state.selection=O,O},getCSSVars:function(){var n,O,_,C=getComputedStyle(this.DOM.scope,null);this.CSSVars={tagHideTransition:(n=function(n){if(!n)return{};var O=(n=n.trim().split(" ")[0]).split(/\d+/g).filter((function(n){return n})).pop().trim();return{value:+n.split(O).filter((function(n){return n}))[0].trim(),unit:O}}((_="tag-hide-transition",C.getPropertyValue("--"+_))),O=n.value,"s"==n.unit?1e3*O:O)}},build:function(n){var O=this.DOM,_=n.closest("label");this.settings.mixMode.integrated?(O.originalInput=null,O.scope=n,O.input=n):(O.originalInput=n,O.originalInput_tabIndex=n.tabIndex,O.scope=this.parseTemplate("wrapper",[n,this.settings]),O.input=O.scope.querySelector(this.settings.classNames.inputSelector),n.parentNode.insertBefore(O.scope,n),n.tabIndex=-1),_&&_.setAttribute("for","")},destroy:function(){var n;this.events.unbindGlobal.call(this),null===(n=this.DOM.scope.parentNode)||void 0===n||n.removeChild(this.DOM.scope),this.DOM.originalInput.tabIndex=this.DOM.originalInput_tabIndex,delete this.DOM.originalInput.__tagify,this.dropdown.hide(!0),this.removeAllCustomListeners(),clearTimeout(this.dropdownHide__bindEventsTimeout),clearInterval(this.listeners.main.originalInputValueObserverInterval)},loadOriginalValues:function(n){var O,_=this.settings;if(this.state.blockChangeEvent=!0,void 0===n){var C=this.getPersistedData("value");n=C&&!this.DOM.originalInput.value?C:_.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value}if(this.removeAllTags(),n)if("mix"==_.mode)this.parseMixTags(n),(O=this.DOM.input.lastChild)&&"BR"==O.tagName||this.DOM.input.insertAdjacentHTML("beforeend","<br>");else{try{X(JSON.parse(n),Array)&&(n=JSON.parse(n))}catch(n){}this.addTags(n,!0).forEach((function(n){return n&&n.classList.add(_.classNames.tagNoAnimation)}))}else this.postUpdate();this.state.lastOriginalValueReported=_.mixMode.integrated?"":this.DOM.originalInput.value},cloneEvent:function(n){var O={};for(var _ in n)"path"!=_&&(O[_]=n[_]);return O},loading:function(n){return this.state.isLoading=n,this.DOM.scope.classList[n?"add":"remove"](this.settings.classNames.scopeLoading),this},tagLoading:function(n,O){return n&&n.classList[O?"add":"remove"](this.settings.classNames.tagLoading),this},toggleClass:function(n,O){"string"==typeof n&&this.DOM.scope.classList.toggle(n,O)},toggleScopeValidation:function(n){var O=!0===n||void 0===n;!this.settings.required&&n&&n===this.TEXTS.empty&&(O=!0),this.toggleClass(this.settings.classNames.tagInvalid,!O),this.DOM.scope.title=O?"":n},toggleFocusClass:function(n){this.toggleClass(this.settings.classNames.focus,!!n)},setPlaceholder:function(n){var O=this;["data","aria"].forEach((function(_){return O.DOM.input.setAttribute("".concat(_,"-placeholder"),n)}))},triggerChangeEvent:function(){if(!this.settings.mixMode.integrated){var n=this.DOM.originalInput,O=this.state.lastOriginalValueReported!==n.value,_=new CustomEvent("change",{bubbles:!0});O&&(this.state.lastOriginalValueReported=n.value,_.simulated=!0,n._valueTracker&&n._valueTracker.setValue(Math.random()),n.dispatchEvent(_),this.trigger("change",this.state.lastOriginalValueReported),n.value=this.state.lastOriginalValueReported)}},events:Q,fixFirefoxLastTagNoCaret:function(){},setRangeAtStartEnd:function(n,O){if(O){n="number"==typeof n?n:!!n,O=O.lastChild||O;var _=document.getSelection();if(X(_.focusNode,Element)&&!this.DOM.input.contains(_.focusNode))return!0;try{_.rangeCount>=1&&["Start","End"].forEach((function(C){return _.getRangeAt(0)["set"+C](O,n||O.length)}))}catch(n){console.warn(n)}}},insertAfterTag:function(n,O){if(O=O||this.settings.mixMode.insertAfterTag,n&&n.parentNode&&O)return O="string"==typeof O?document.createTextNode(O):O,n.parentNode.insertBefore(O,n.nextSibling),O},editTagChangeDetected:function(n){var O=n.__originalData;for(var _ in O)if(!this.dataProps.includes(_)&&n[_]!=O[_])return!0;return!1},getTagTextNode:function(n){return n.querySelector(this.settings.classNames.tagTextSelector)},setTagTextNode:function(n,O){this.getTagTextNode(n).innerHTML=d(O)},editTag:function(n,_){var C=this;n=n||this.getLastTag(),_=_||{};var A=this.settings,k=this.getTagTextNode(n),L=this.getNodeIndex(n),j=w(n),U=this.events.callbacks,Q=!0,Y="select"==A.mode;if(!Y&&this.dropdown.hide(),k){if(!X(j,Object)||!("editable"in j)||j.editable)return j=w(n,{__originalData:u({},j),__originalHTML:n.cloneNode(!0)}),w(j.__originalHTML,j.__originalData),k.setAttribute("contenteditable",!0),n.classList.add(A.classNames.tagEditing),this.events.callbacks.onEditTagFocus.call(this,n),k.addEventListener("click",U.onEditTagClick.bind(this,n)),k.addEventListener("blur",U.onEditTagBlur.bind(this,this.getTagTextNode(n))),k.addEventListener("input",U.onEditTagInput.bind(this,k)),k.addEventListener("paste",U.onEditTagPaste.bind(this,k)),k.addEventListener("keydown",(function(O){return U.onEditTagkeydown.call(C,O,n)})),k.addEventListener("compositionstart",U.onCompositionStart.bind(this)),k.addEventListener("compositionend",U.onCompositionEnd.bind(this)),_.skipValidation||(Q=this.editTagToggleValidity(n)),k.originalIsValid=Q,this.trigger("edit:start",{tag:n,index:L,data:j,isValid:Q}),k.focus(),!Y&&this.setRangeAtStartEnd(!1,k),0===A.dropdown.enabled&&!Y&&this.dropdown.show(),this.state.hasFocus=!0,this}else O.warn("Cannot find element in Tag template: .",A.classNames.tagTextSelector)},editTagToggleValidity:function(n,_){var C;if(_=_||w(n))return(C=!("__isValid"in _)||!0===_.__isValid)||this.removeTagsFromValue(n),this.update(),n.classList.toggle(this.settings.classNames.tagNotAllowed,!C),_.__isValid=C,_.__isValid;O.warn("tag has no data: ",n,_)},onEditTagDone:function(n,O){n=n||this.state.editing.scope,O=O||{};var _,C,A={tag:n,index:this.getNodeIndex(n),previousData:w(n),data:O},k=this.settings;this.trigger("edit:beforeUpdate",A,{cloneData:!1}),this.state.editing=!1,delete O.__originalData,delete O.__originalHTML,n&&(void 0!==(C=O[k.tagTextProp])?null===(_=(C+="").trim)||void 0===_?void 0:_.call(C):k.tagTextProp in O?void 0:O.value)?(n=this.replaceTag(n,O),this.editTagToggleValidity(n,O),k.a11y.focusableTags?n.focus():"select"!=k.mode&&y(n)):n&&this.removeTags(n),this.trigger("edit:updated",A),this.dropdown.hide(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag:function(n,O){O&&""!==O.value&&void 0!==O.value||(O=n.__tagifyTagData),O.__isValid&&1!=O.__isValid&&u(O,this.getInvalidTagAttrs(O,O.__isValid));var _=this.createTagElem(O);return n.parentNode.replaceChild(_,n),this.updateValueByDOMTags(),_},updateValueByDOMTags:function(){var n=this;this.value.length=0;var O=this.settings.classNames,_=[O.tagNotAllowed.split(" ")[0],O.tagHide];[].forEach.call(this.getTagElms(),(function(O){G(O.classList).some((function(n){return _.includes(n)}))||n.value.push(w(O))})),this.update()},injectAtCaret:function(n,O){var _;if(O=O||(null===(_=this.state.selection)||void 0===_?void 0:_.range),"string"==typeof n&&(n=document.createTextNode(n)),!O&&n)return this.appendMixTags(n),this;var C=b(n,O);return this.setRangeAtStartEnd(!1,C),this.updateValueByDOMTags(),this.update(),this},input:{set:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],_=this.settings,C=_.dropdown.closeOnSelect;this.state.inputText=n,O&&(this.DOM.input.innerHTML=d(""+n),n&&this.toggleClass(_.classNames.empty,!this.DOM.input.innerHTML)),!n&&C&&this.dropdown.hide.bind(this),this.input.autocomplete.suggest.call(this),this.input.validate.call(this)},raw:function(){return this.DOM.input.textContent},validate:function(){var n=!this.state.inputText||!0===this.validateTag({value:this.state.inputText});return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!n),n},normalize:function(n,O){var _=n||this.DOM.input,C=[];_.childNodes.forEach((function(n){return 3==n.nodeType&&C.push(n.nodeValue)})),C=C.join("\n");try{C=C.replace(/(?:\r\n|\r|\n)/g,this.settings.delimiters.source.charAt(0))}catch(n){}return C=C.replace(/\s/g," "),(null==O?void 0:O.trim)?this.trim(C):C},autocomplete:{suggest:function(n){if(this.settings.autoComplete.enabled){"object"!=typeof(n=n||{value:""})&&(n={value:n});var O=this.dropdown.getMappedValue(n);if("number"!=typeof O){var _=this.state.inputText.toLowerCase(),C=O.substr(0,this.state.inputText.length).toLowerCase(),A=O.substring(this.state.inputText.length);O&&this.state.inputText&&C==_?(this.DOM.input.setAttribute("data-suggest",A),this.state.inputSuggestion=n):(this.DOM.input.removeAttribute("data-suggest"),delete this.state.inputSuggestion)}}},set:function(n){var O=this.DOM.input.getAttribute("data-suggest"),_=n||(O?this.state.inputText+O:null);return!!_&&("mix"==this.settings.mode?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+_)):(this.input.set.call(this,_),this.setRangeAtStartEnd(!1,this.DOM.input)),this.input.autocomplete.suggest.call(this),this.dropdown.hide(),!0)}}},getTagIdx:function(n){return this.value.findIndex((function(O){return O.__tagId==(n||{}).__tagId}))},getNodeIndex:function(n){var O=0;if(n)for(;n=n.previousElementSibling;)O++;return O},getTagElms:function(){for(var n=arguments.length,O=new Array(n),_=0;_<n;_++)O[_]=arguments[_];var C="."+G(this.settings.classNames.tag.split(" ")).concat(G(O)).join(".");return[].slice.call(this.DOM.scope.querySelectorAll(C))},getLastTag:function(){var n=this.settings.classNames,O=this.DOM.scope.querySelectorAll("".concat(n.tagSelector,":not(.").concat(n.tagHide,"):not([readonly])"));return O[O.length-1]},isTagDuplicate:function(n,O,_){var C=0,A=!0,k=!1,L=void 0;try{for(var j,U=this.value[Symbol.iterator]();!(A=(j=U.next()).done);A=!0){var Q=j.value;s(this.trim(""+n),Q.value,O)&&_!=Q.__tagId&&C++}}catch(n){k=!0,L=n}finally{try{A||null==U.return||U.return()}finally{if(k)throw L}}return C},getTagIndexByValue:function(n){var O=this,_=[],C=this.settings.dropdown.caseSensitive;return this.getTagElms().forEach((function(A,k){A.__tagifyTagData&&s(O.trim(A.__tagifyTagData.value),n,C)&&_.push(k)})),_},getTagElmByValue:function(n){var O=this.getTagIndexByValue(n)[0];return this.getTagElms()[O]},flashTag:function(n){var O=this;n&&(n.classList.add(this.settings.classNames.tagFlash),setTimeout((function(){n.classList.remove(O.settings.classNames.tagFlash)}),100))},isTagBlacklisted:function(n){return n=this.trim(n.toLowerCase()),this.settings.blacklist.filter((function(O){return(""+O).toLowerCase()==n})).length},isTagWhitelisted:function(n){return!!this.getWhitelistItem(n)},getWhitelistItem:function(n,O,_){O=O||"value";var C,A=this.settings;return(_=_||A.whitelist).some((function(_){var k="object"==typeof _?_[O]||_.value:_;if(s(k,n,A.dropdown.caseSensitive,A.trim))return C="object"==typeof _?_:{value:_},!0})),C||"value"!=O||"value"==A.tagTextProp||(C=this.getWhitelistItem(n,A.tagTextProp,_)),C},validateTag:function(n){var O=this.settings,_="value"in n?"value":O.tagTextProp,C=this.trim(n[_]+"");return(n[_]+"").trim()?"mix"!=O.mode&&O.pattern&&X(O.pattern,RegExp)&&!O.pattern.test(C)?this.TEXTS.pattern:!O.duplicates&&this.isTagDuplicate(C,O.dropdown.caseSensitive,n.__tagId)?this.TEXTS.duplicate:this.isTagBlacklisted(C)||O.enforceWhitelist&&!this.isTagWhitelisted(C)?this.TEXTS.notAllowed:!O.validate||O.validate(n):this.TEXTS.empty},getInvalidTagAttrs:function(n,O){return{"aria-invalid":!0,class:"".concat(n.class||""," ").concat(this.settings.classNames.tagNotAllowed).trim(),title:O}},hasMaxTags:function(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly:function(n,O){var _=this.settings;this.DOM.scope.contains(document.activeElement)&&document.activeElement.blur(),_[O||"readonly"]=n,this.DOM.scope[(n?"set":"remove")+"Attribute"](O||"readonly",!0),this.settings.userInput=!0,this.setContentEditable(!n)},setContentEditable:function(n){this.DOM.input.contentEditable=n,this.DOM.input.tabIndex=n?0:-1},setDisabled:function(n){this.setReadonly(n,"disabled")},normalizeTags:function(n){var O=this,_=this.settings,C=_.whitelist,A=_.delimiters,k=_.mode,L=_.tagTextProp,j=[],U=!!C&&X(C[0],Object),Q=Array.isArray(n),Y=Q&&n[0].value,h=function(n){return(n+"").split(A).reduce((function(n,_){var C,A=O.trim(_);return A&&n.push((z(C={},L,A),z(C,"value",A),C)),n}),[])};if("number"==typeof n&&(n=n.toString()),"string"==typeof n){if(!n.trim())return[];n=h(n)}else Q&&(n=n.reduce((function(n,_){if(c(_)){var C=u({},_);L in C||(L="value"),C[L]=O.trim(C[L]),(C[L]||0===C[L])&&n.push(C)}else if(null!=_&&""!==_&&void 0!==_){var A;(A=n).push.apply(A,G(h(_)))}return n}),[]));return U&&!Y&&(n.forEach((function(n){var _=j.map((function(n){return n.value})),C=O.dropdown.filterListItems.call(O,n[L],{exact:!0});O.settings.duplicates||(C=C.filter((function(n){return!_.includes(n.value)})));var A=C.length>1?O.getWhitelistItem(n[L],L,C):C[0];A&&X(A,Object)?j.push(A):"mix"!=k&&(null==n.value&&(n.value=n[L]),j.push(n))})),j.length&&(n=j)),n},parseMixTags:function(n){var O=this,_=this.settings,C=_.mixTagsInterpolator,A=_.duplicates,k=_.transformTag,L=_.enforceWhitelist,j=_.maxTags,U=_.tagTextProp,Q=[];n=n.split(C[0]).map((function(n,_){var Y,Z,tt,et=n.split(C[1]),it=et[0],nt=Q.length==j;try{if(it==+it)throw Error;Z=JSON.parse(it)}catch(n){Z=O.normalizeTags(it)[0]||{value:it}}if(k.call(O,Z),nt||!(et.length>1)||L&&!O.isTagWhitelisted(Z.value)||!A&&O.isTagDuplicate(Z.value)){if(n)return _?C[0]+n:n}else Z[Y=Z[U]?U:"value"]=O.trim(Z[Y]),tt=O.createTagElem(Z),Q.push(Z),tt.classList.add(O.settings.classNames.tagNoAnimation),et[0]=tt.outerHTML,O.value.push(Z);return et.join("")})).join(""),this.DOM.input.innerHTML=n,this.DOM.input.appendChild(document.createTextNode("")),this.DOM.input.normalize();var Y=this.getTagElms();return Y.forEach((function(n,O){return w(n,Q[O])})),this.update({withoutChangeEvent:!0}),T(Y,this.state.hasFocus),n},replaceTextWithNode:function(n,O){if(this.state.tag||O){O=O||this.state.tag.prefix+this.state.tag.value;var _,C,A=this.state.selection||window.getSelection(),k=A.anchorNode,L=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return k.splitText(A.anchorOffset-L),-1==(_=k.nodeValue.lastIndexOf(O))||(C=k.splitText(_),n&&k.parentNode.replaceChild(n,C)),!0}},prepareNewTagNode:function(n,O){O=O||{};var _=this.settings,C=[],A={},k=Object.assign({},n,{value:n.value+""});if(n=Object.assign({},k),_.transformTag.call(this,n),n.__isValid=this.hasMaxTags()||this.validateTag(n),!0!==n.__isValid){if(O.skipInvalid)return;if(u(A,this.getInvalidTagAttrs(n,n.__isValid),{__preInvalidData:k}),n.__isValid==this.TEXTS.duplicate&&this.flashTag(this.getTagElmByValue(n.value)),!_.createInvalidTags)return void C.push(n.value)}return"readonly"in n&&(n.readonly?A["aria-readonly"]=!0:delete n.readonly),{tagElm:this.createTagElem(n,A),tagData:n,aggregatedInvalidInput:C}},postProcessNewTagNode:function(n,O){var _=this,C=this.settings,A=O.__isValid;A&&!0===A?this.value.push(O):(this.trigger("invalid",{data:O,index:this.value.length,tag:n,message:A}),C.keepInvalidTags||setTimeout((function(){return _.removeTags(n,!0)}),1e3)),this.dropdown.position()},selectTag:function(n,O){var _=this;if(!this.settings.enforceWhitelist||this.isTagWhitelisted(O.value)){this.state.actions.selectOption&&setTimeout((function(){return _.setRangeAtStartEnd(!1,_.DOM.input)}));var C=this.getLastTag();return C?this.replaceTag(C,O):this.appendTag(n),this.value[0]=O,this.update(),this.trigger("add",{tag:n,data:O}),[n]}},addEmptyTag:function(n){var O=u({value:""},n||{}),_=this.createTagElem(O);w(_,O),this.appendTag(_),this.editTag(_,{skipValidation:!0}),this.toggleFocusClass(!0)},addTags:function(n,O,_){var C=this,A=[],k=this.settings,L=[],j=document.createDocumentFragment(),U=[];if(!n||0==n.length)return A;switch(n=this.normalizeTags(n),k.mode){case"mix":return this.addMixTags(n);case"select":O=!1,this.removeAllTags()}return this.DOM.input.removeAttribute("style"),n.forEach((function(n){var O=C.prepareNewTagNode(n,{skipInvalid:_||k.skipInvalid});if(O){var Q=O.tagElm;if(n=O.tagData,L=O.aggregatedInvalidInput,A.push(Q),"select"==k.mode)return C.selectTag(Q,n);j.appendChild(Q),C.postProcessNewTagNode(Q,n),U.push({tagElm:Q,tagData:n})}})),this.appendTag(j),U.forEach((function(n){var O=n.tagElm,_=n.tagData;return C.trigger("add",{tag:O,index:C.getTagIdx(_),data:_})})),this.update(),n.length&&O&&(this.input.set.call(this,k.createInvalidTags?"":L.join(k._delimiters)),this.setRangeAtStartEnd(!1,this.DOM.input)),this.dropdown.refilter(),A},addMixTags:function(n){var O=this;if((n=this.normalizeTags(n))[0].prefix||this.state.tag)return this.prefixedTextToTag(n[0]);var _=document.createDocumentFragment();return n.forEach((function(n){var C=O.prepareNewTagNode(n);_.appendChild(C.tagElm),O.insertAfterTag(C.tagElm),O.postProcessNewTagNode(C.tagElm,C.tagData)})),this.appendMixTags(_),_.children},appendMixTags:function(n){var O=!!this.state.selection;O?this.injectAtCaret(n):(this.DOM.input.focus(),(O=this.setStateSelection()).range.setStart(this.DOM.input,O.range.endOffset),O.range.setEnd(this.DOM.input,O.range.endOffset),this.DOM.input.appendChild(n),this.updateValueByDOMTags(),this.update())},prefixedTextToTag:function(n){var O,_,C,A=this,k=this.settings,L=null===(O=this.state.tag)||void 0===O?void 0:O.delimiters;if(n.prefix=n.prefix||this.state.tag?this.state.tag.prefix:(k.pattern.source||k.pattern)[0],C=this.prepareNewTagNode(n),_=C.tagElm,this.replaceTextWithNode(_)||this.DOM.input.appendChild(_),setTimeout((function(){return _.classList.add(A.settings.classNames.tagNoAnimation)}),300),this.update(),!L){var j=this.insertAfterTag(_)||_;setTimeout(y,0,j)}return this.state.tag=null,this.postProcessNewTagNode(_,C.tagData),_},appendTag:function(n){var O=this.DOM,_=O.input;O.scope.insertBefore(n,_)},createTagElem:function(n,O){n.__tagId=f();var _,C=u({},n,J({value:d(n.value+"")},O));return function(n){for(var O,_=document.createNodeIterator(n,NodeFilter.SHOW_TEXT,null,!1);O=_.nextNode();)O.textContent.trim()||O.parentNode.removeChild(O)}(_=this.parseTemplate("tag",[C,this])),w(_,n),_},reCheckInvalidTags:function(){var n=this,O=this.settings;this.getTagElms(O.classNames.tagNotAllowed).forEach((function(_,C){var A=w(_),k=n.hasMaxTags(),L=n.validateTag(A),j=!0===L&&!k;if("select"==O.mode&&n.toggleScopeValidation(L),j)return A=A.__preInvalidData?A.__preInvalidData:{value:A.value},n.replaceTag(_,A);_.title=k||L}))},removeTags:function(n,O,_){var C,A=this,k=this.settings;if(n=n&&X(n,HTMLElement)?[n]:X(n,Array)?n:n?[n]:[this.getLastTag()].filter((function(n){return n})),C=n.reduce((function(n,O){O&&"string"==typeof O&&(O=A.getTagElmByValue(O));var _=w(O);return O&&_&&!_.readonly&&n.push({node:O,idx:A.getTagIdx(_),data:w(O,{__removed:!0})}),n}),[]),_="number"==typeof _?_:this.CSSVars.tagHideTransition,"select"==k.mode&&(_=0,this.input.set.call(this)),1==C.length&&"select"!=k.mode&&C[0].node.classList.contains(k.classNames.tagNotAllowed)&&(O=!0),C.length)return k.hooks.beforeRemoveTag(C,{tagify:this}).then((function(){var t=function(n){n.node.parentNode&&(n.node.parentNode.removeChild(n.node),O?k.keepInvalidTags&&this.trigger("remove",{tag:n.node,index:n.idx}):(this.trigger("remove",{tag:n.node,index:n.idx,data:n.data}),this.dropdown.refilter(),this.dropdown.position(),this.DOM.input.normalize(),k.keepInvalidTags&&this.reCheckInvalidTags()))};_&&_>10&&1==C.length?function(n){n.node.style.width=parseFloat(window.getComputedStyle(n.node).width)+"px",document.body.clientTop,n.node.classList.add(k.classNames.tagHide),setTimeout(t.bind(this),_,n)}.call(A,C[0]):C.forEach(t.bind(A)),O||(A.removeTagsFromValue(C.map((function(n){return n.node}))),A.update(),"select"==k.mode&&k.userInput&&A.setContentEditable(!0))})).catch((function(n){}))},removeTagsFromDOM:function(){this.getTagElms().forEach((function(n){return n.remove()}))},removeTagsFromValue:function(n){var O=this;(n=Array.isArray(n)?n:[n]).forEach((function(n){var _=w(n),C=O.getTagIdx(_);C>-1&&O.value.splice(C,1)}))},removeAllTags:function(n){var O=this;n=n||{},this.value=[],"mix"==this.settings.mode?this.DOM.input.innerHTML="":this.removeTagsFromDOM(),this.dropdown.refilter(),this.dropdown.position(),this.state.dropdown.visible&&setTimeout((function(){O.DOM.input.focus()})),"select"==this.settings.mode&&(this.input.set.call(this),this.settings.userInput&&this.setContentEditable(!0)),this.update(n)},postUpdate:function(){this.state.blockChangeEvent=!1;var n,O,_=this.settings,C=_.classNames,A="mix"==_.mode?_.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value.trim():this.value.length+this.input.raw.call(this).length;(this.toggleClass(C.hasMaxTags,this.value.length>=_.maxTags),this.toggleClass(C.hasNoTags,!this.value.length),this.toggleClass(C.empty,!A),"select"==_.mode)&&this.toggleScopeValidation(null===(O=this.value)||void 0===O||null===(n=O[0])||void 0===n?void 0:n.__isValid)},setOriginalInputValue:function(n){var O=this.DOM.originalInput;this.settings.mixMode.integrated||(O.value=n,O.tagifyValue=O.value,this.setPersistedData(n,"value"))},update:function(n){clearTimeout(this.debouncedUpdateTimeout),this.debouncedUpdateTimeout=setTimeout(function(){var O=this.getInputValue();this.setOriginalInputValue(O),this.settings.onChangeAfterBlur&&(n||{}).withoutChangeEvent||this.state.blockChangeEvent||this.triggerChangeEvent();this.postUpdate()}.bind(this),100),this.events.bindOriginaInputListener.call(this,100)},getInputValue:function(){var n=this.getCleanValue();return"mix"==this.settings.mode?this.getMixedTagsAsString(n):n.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(n):JSON.stringify(n):""},getCleanValue:function(n){return a(n||this.value,this.dataProps)},getMixedTagsAsString:function(){var n="",O=this,_=this.settings,C=_.originalInputValueFormat||JSON.stringify,A=_.mixTagsInterpolator;return function i(_){_.childNodes.forEach((function(_){if(1==_.nodeType){var k=w(_);if("BR"==_.tagName&&(n+="\r\n"),k&&m.call(O,_)){if(k.__removed)return;n+=A[0]+C(o(k,O.dataProps))+A[1]}else _.getAttribute("style")||["B","I","U"].includes(_.tagName)?n+=_.textContent:"DIV"!=_.tagName&&"P"!=_.tagName||(n+="\r\n",i(_))}else n+=_.textContent}))}(this.DOM.input),n}},$.prototype.removeTag=$.prototype.removeTags;export{$ as default};

